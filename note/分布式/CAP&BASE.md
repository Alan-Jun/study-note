# CAP

https://cloud.tencent.com/developer/article/1860632

分布式系统不可能同时满足一致性（C：Consistency）、可用性（A：Availability , 任何时候的读/写都要能成功）和分区容忍性（P：Partition Tolerance），最多只能同时满足其中两项。

CAP 本身基于状态，基于瞬态，是一个描述性的理论，它并不解决工程问题。

由于 CAP 是学术理论，并不是工程理论，它会舍弃很多现实世界的问题。比如网络的时长，比如节点内部的处理速度不一致，比如节点间存储方式和速度的不一致。**它说的一致性就是客户端是否能拿到最新数据，它说的可用性就是允许客户端拿不到最新数据**。而这些东西被工程师们的过多脑补，导致了文章和文章说法不一样，解析不一样，阐述背景不一样。

## 权衡

在分布式系统中，分区容忍性必不可少，因为需要总是假设网络是不可靠的。因此，CAP 理论实际上是要在可用性和一致性之间做权衡。

可用性和一致性往往是冲突的，很难使它们同时满足。在多个节点之间进行数据同步时，

- 为了保证一致性（CP），不能访问未同步完成的节点，也就失去了部分可用性；
- 为了保证可用性（AP），允许读取所有节点的数据，但是数据可能不一致。

# BASE

BASE 是基本可用（Basically Available）、软状态（Soft State）和最终一致性（Eventually Consistent）三个短语的缩写。

BASE 理论是对 CAP 中一致性和可用性权衡的结果，它的核心思想是：即使无法做到强一致性，但每个应用都可以根据自身业务特点，采用适当的方式来使系统达到最终一致性。

## 基本可用

指分布式系统在出现故障的时候，保证核心可用，允许损失部分可用性。

例如

* 电商在做促销时，为了保证购物系统的稳定性，部分消费者可能会被引导到一个降级的页面。
* 如果正常的查询时100ms,但是由于系统出现了一些问题，耗时到了1000ms

## 软状态

指允许系统中的数据存在中间状态，并认为该中间状态不会影响系统整体可用性，即允许系统不同节点的数据副本之间进行同步的过程存在时延。

## 最终一致性

最终一致性强调的是系统中所有的数据副本，在经过一段时间的同步后，最终能达到一致的状态。

ACID 要求强一致性，通常运用在传统的数据库系统上。而 BASE 要求最终一致性，通过牺牲强一致性来达到可用性，通常运用在大型分布式系统中。

在实际的分布式场景中，不同业务单元和组件对一致性的要求是不同的，因此 ACID 和 BASE 往往会结合在一起使用。