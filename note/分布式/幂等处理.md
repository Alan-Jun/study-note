# 查询操作

查询一次和多次在存储层数据没有变的时候一定是一样的，select是天然具有幂等性的

# 删除操作

删除操作在第一次你删除成功之后，不管你删除多少次都是天然幂等的

# 其他操作

幂等性方案：https://cloud.tencent.com/developer/news/838221

# 唯一索引

可以通过唯一索引来保证insert的幂等。比如一个平台以手机号标识唯一的账号，那么就可以将手机信息作为一个唯一索引，保证一个手机号在数据库层就只有一条数据

# token机制

防止页面重复提交

在执行业务前向服务端申请token, 在执行业务的时候将 token带在参数中，服务端检查token是否存在，不存在就拒绝，存在删除这个token, 然后执行业务操作，如果不存在就提示客户端重复提交。

# 消费消息幂等处理

可以通过消息id作为唯一id, 利用上面唯一索引的方式，或则利用缓存的方式，在一个时间段内只处理一个消息id.其他拒绝

缓存得方式怎么做呢？ 

1. 判断当前id得缓存是否存在，存在则丢弃该消息得处理。
2. 不存在则处理消息，先设置消息得id缓存,以及一个有效期（消息平均处理耗时的4倍左右比较好），如果设置失败则丢失处理逻辑
3. 如果设置成功则开始执行后续处理逻辑，如果处理逻辑执行失败那么需要重试（可以是自己实现得，也可以是某些MQ带有的重试功能（RocketMQ），**如果是这种方式需要删除id缓存，不然后续再次消费可能被幂等逻辑拦截掉**）
4. 处理成功，可以将id的缓存的过期时间做一定的延长，避免网络中的重复消息延迟到达MQ broker ,然后被重复消费了。



